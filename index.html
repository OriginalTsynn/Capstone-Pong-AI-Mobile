<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Pong</title>
    <!-- must call phaser before any other script -->
    <script type="text/javascript" src="phaser.min.js"></script>
    <style type = "text/css">
    body {
        margin: 0;
        height: 100vh;
        width: 100vw;
        }
    </style>
</head>
<body>
    <script type = "text/javascript">
        //   initializing the phaser game!  pixels, auto-detect, and core functions
        var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {preload: preload, create: create, update: update})

        //  initiate players
        var paddle1
        var paddle2
        //  ball stuff
        var ball
        var ball_launched
        var ball_velocity
        //  score stuff
        var score1_text
        var score2_text
        var score1
        var score2
        //  maybe keyboard control
        var cursors
// -------------------------------------------------------------


        // preload is for loading everything
        function preload(){
            // image files
            this.load.image('paddle', '../assets/paddle.png')
            this.load.image('ball', '../assets/ball.png')

            // sound files
            game.load.audio('hit_1', ['../assets/hit_1.wav'])
            game.load.audio('hit_2', ['../assets/hit_2.wav'])

        }
// -------------------------------------------------------------
        // the set up function
        function create(){
            //  Phaser sets things up in layers.  First to be called will be the bottom most layer.
            //  thus any background images need to be loaded first, otherwise they will cover over anything else
            game.stage.backgroundColor = '#888888';
            // Create the paddles
            paddle1 = create_paddle(0, game.world.centerY)
            paddle2 = create_paddle(game.world.width -8,game.world.centerY)
            // Create the ball
            ball_launched = false
            ball_velocity = 350                                 //  inital ball velocity.  Can have different starting points if I implement difficulties
            ball = create_ball(game.world.centerX, game.world.centerY)
            game.input.onDown.add(launch_ball, this)            //  launch the ball on mouse click
            //  Scoreboard
            score1_text = game.add.text(128,128, '0', {font: "64px Gabriella", fill: "#ffffff", align: "center"})
            score2_text = game.add.text(game.world.width -128,128, '0', {font: "64px Gabriella", fill: "#ffffff", align: "center"})
            score1 = 0
            score2 = 0
            //  Input Events
            // cursors = this.input.keyboard.createCursorKeys();
        }
// -------------------------------------------------------------
        //  this is what updates every frame
        function update(){
            score1_text.text = score1
            score2_text.text = score2

            control_paddle(paddle1, game.input.y, game.input.x)  //  give us control of the left paddle

            //  set up collision for paddles and ball with sound effects!
            game.physics.arcade.collide(paddle1, ball, function(){
                game.sound.play('hit_1')
                })
            game.physics.arcade.collide(paddle2, ball, function(){
                game.sound.play('hit_2')
                })
            //  scoreboard updating
            if(ball.body.blocked.right){
                score1 += 1
                console.log('exit right, p1 scores')
            }
            if(ball.body.blocked.left){
                score2 += 1
                console.log('exit left, computer scores')
            }

            //  Introducing our fake AI computer opponent!
            paddle2.body.velocity.setTo(ball.body.velocity.y)       // This gets paddle 2 to track the ball
            // paddle2.body.velocity.x=0                               // disable movement on x axis for p2
            paddle2.body.maxVelocity.y = 250                        // cap p2 y velocity
            paddle2.body.maxVelocity.x = 250                        // cap p2 x velocity

        }


// -------------------------------------------------------------
        function create_paddle(x, y) {
            var paddle = game.add.sprite(x,y,'paddle')
            paddle.anchor.setTo(0.5,0.5)                        //  Sets anchor to the middle of the sprite body
            game.physics.arcade.enable(paddle)                  //  Enable physics
            paddle.body.collideWorldBounds = true               //  Don't let the paddle leave the confines of the world
            paddle.body.immovable = true                        //  Set paddle to immovable/impassable
            paddle.scale.setTo(0.5,0.5)                         //  shrink paddle size by 50%

            return paddle
                }
        function control_paddle(paddle, y, x){
            paddle.x = x
            paddle.y = y
            if(paddle.y < paddle.height / 2){
                paddle.y = paddle.height / 2
            } else if (paddle.y > game.world.height - paddle.height / 2){
                paddle.y = game.world.height - paddle.height / 2
                }
            if(paddle.x < paddle.width / 2){
                paddle.x = paddle.width / 2
            } else if (paddle.x > game.world.width - paddle.width / 2){
                paddle.x = game.world.width - paddle.width / 2
                }
            }


// -------------------------------------------------------------

        function create_ball(x, y){
            var ball = game.add.sprite(x,y,'ball')
            ball.anchor.setTo(0.5,0.5)                          //  Sets anchor to the middle of the sprite body
            game.physics.arcade.enable(ball, true)                    //  Enable physics
            ball.body.collideWorldBounds = true                 //  Keeps ball confined to world
            ball.body.bounce.setTo(0.9,0.9)                        //  Setting bounce velocities
            ball.scale.setTo(0.25,0.25)                         //  shrink ball size to 25% of original

            return ball
        }

        function launch_ball(){
            if(ball_launched){
                ball.x = game.world.centerX
                ball.y = game.world.centerY
                ball.body.velocity.setTo(0,0)
                ball_launched = false
            } else {
                ball.body.velocity.x = -ball_velocity
                ball.body.velocity.y = ball_velocity
                ball_launched = true
            }
        }










        </script>
</body>
</html>


